<script>
  export default {
    data () {
      return {
        enabled: true,
        trackerName: 'ga'
      }
    },

    oncreate () {
      const { trackerName } = this.get()
      if (window[trackerName]) {
				this.set({ ga: window[trackerName] })
        return
      }
			
      const { trackingId, enabled } = this.get()

      if (!trackingId) {
        throw new Error('Google Analytics configuration parameter is required, try <GoogleAnalytics trackingId="12345" />')
      }

      /* eslint-disable */
      const scr = function (i,s,o,g,r,a,m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];
        a.async=1;
        a.src=g;
        m.parentNode.insertBefore(a,m);
      }
			
			scr(window, document, 'script', '//www.google-analytics.com/analytics.js', trackerName, undefined, undefined)
      /* eslint-enable */

			this.set({ ga: window[trackerName] })
			
      if (enabled) {
        this.enable()
      }
    },

    methods: {
      enable () {
        this.init()
        this.send('pageview')
      },

      init () {
        const { trackingId } = this.get()
        this.query('create', trackingId, 'auto')
      },

      send (...options) {
        this.query('send', ...options)
      },

      query (cmd, ...options) {
        const { ga } = this.get()

        if (options.length === 1) {
          ga(cmd, options[0])
        } else {
          ga(cmd, ...options)
        }

      },

      plugin (name, fn) {
        this.query('provide', name, fn)
      }
    }
  }
</script>
